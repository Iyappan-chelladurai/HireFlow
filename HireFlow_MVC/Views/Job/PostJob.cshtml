@model HireFlow_MVC.Models.JobViewModel
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    Layout = "_SystemLayout";
    ViewData["Title"] = "Post Job";

    var UserId = HttpContextAccessor.HttpContext.Session.GetString("UserId");
}
<!-- Include stylesheet -->
<link href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" rel="stylesheet">
<style>
    :root {
        --primary: #2563eb;
        --primary-dark: #1d4ed8;
        --secondary: #7e22ce;
        --dark: #1e293b;
        --light: #f8fafc;
        --gray: #64748b;
        --success: #10b981;
        --warning: #f59e0b;
        --error: #ef4444;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Inter', sans-serif;
        color: var(--dark);
        line-height: 1.6;
        background-color: var(--light);
        overflow-x: hidden;
    }

    a {
        text-decoration: none;
        color: inherit;
    }

    ul {
        list-style: none;
    }

    .container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }

    /* Header & Navigation */
    header {
        background-color: rgba(255, 255, 255, 0.95);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
        backdrop-filter: blur(10px);
    }

    .header-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 0;
    }

    .logo {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--primary);
        display: flex;
        align-items: center;
    }

        .logo span {
            color: var(--secondary);
        }

    .nav-menu {
        display: flex;
        gap: 30px;
    }

    .nav-link {
        font-weight: 500;
        transition: color 0.3s;
        position: relative;
    }

        .nav-link:hover {
            color: var(--primary);
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary);
            transition: width 0.3s;
        }

        .nav-link:hover::after {
            width: 100%;
        }

    .nav-cta {
        background-color: var(--primary);
        color: white;
        padding: 10px 20px;
        border-radius: 30px;
        font-weight: 600;
        transition: all 0.3s;
    }

        .nav-cta:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .nav-cta::after {
            display: none;
        }

    .mobile-toggle {
        display: none;
        font-size: 1.5rem;
        cursor: pointer;
    }

    /* Sidebar */
    .sidebar {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: white;
        height: 100vh;
        position: fixed;
        width: 250px;
        padding-top: 100px;
        left: 0;
        top: 0;
        z-index: 900;
    }

        .sidebar a {
            color: white;
            padding: 15px 25px;
            display: block;
            text-decoration: none;
            transition: all 0.3s;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
        }

            .sidebar a:hover,
            .sidebar a.active {
                background-color: rgba(255, 255, 255, 0.1);
                padding-left: 30px;
            }

    /* Main Content */
    .main-content {
        margin-left: 250px;
        padding: 100px 20px 40px;
    }

    /* Page Header */
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
    }

    .page-title {
        font-size: 1.8rem;
        font-weight: 700;
    }

    .back-button {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: var(--primary);
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
        padding: 8px 16px;
        border-radius: 8px;
        background-color: #e0f2fe;
    }

        .back-button:hover {
            background-color: #dbeafe;
        }

    /* View Toggle */
    .view-toggle {
        display: flex;
        background-color: #f1f5f9;
        border-radius: 8px;
        padding: 5px;
        margin-bottom: 20px;
    }

    .view-toggle-btn {
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
        border: none;
        background: none;
    }

        .view-toggle-btn.active {
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

    /* Search and Filters */
    .search-filters {
        background-color: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        margin-bottom: 30px;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .search-box {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
    }

    .search-input {
        flex: 1;
        padding: 12px 16px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s;
    }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

    .search-button {
        background-color: var(--primary);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 0 20px;
        cursor: pointer;
        transition: all 0.3s;
    }

        .search-button:hover {
            background-color: var(--primary-dark);
        }

    .filter-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .filter-label {
        font-weight: 500;
        font-size: 0.9rem;
        margin-bottom: 5px;
    }

    .filter-select {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-family: 'Inter', sans-serif;
        font-size: 0.9rem;
        transition: border-color 0.3s;
    }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
        }

    /* Tables */
    .table-responsive {
        overflow-x: auto;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        background-color: white;
        margin-bottom: 30px;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
    }

        .data-table th {
            background-color: #f8fafc;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--gray);
            border-bottom: 2px solid #e2e8f0;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table tr:hover {
            background-color: #f8fafc;
        }

    .job-title-cell {
        font-weight: 600;
        color: var(--primary);
        cursor: pointer;
        transition: color 0.3s;
    }

        .job-title-cell:hover {
            color: var(--primary-dark);
        }

    .status-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .status-active {
        background-color: #d1fae5;
        color: #065f46;
    }

    .status-draft {
        background-color: #fef3c7;
        color: #92400e;
    }

    .status-closed {
        background-color: #e5e7eb;
        color: #374151;
    }

    /* Buttons */
    .btn {
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
        border: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .btn-primary {
        background-color: var(--primary);
        color: white;
    }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3);
        }

    .btn-success {
        background-color: var(--success);
        color: white;
    }

        .btn-success:hover {
            background-color: #0d966c;
            transform: translateY(-2px);
        }

    /* Modal Styles */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        padding: 20px;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s;
    }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

    .modal {
        background-color: white;
        border-radius: 15px;
        width: 100%;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
        padding: 40px;
        position: relative;
        transform: translateY(50px);
        transition: transform 0.5s;
    }

    .modal-overlay.active .modal {
        transform: translateY(0);
    }

    .modal-close {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--gray);
        transition: color 0.3s;
        background: none;
        border: none;
    }

        .modal-close:hover {
            color: var(--dark);
        }

    .modal-title {
        font-size: 1.8rem;
        margin-bottom: 5px;
    }

    .modal-subtitle {
        color: var(--gray);
        margin-bottom: 30px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
    }

    .form-input,
    .form-select,
    .form-textarea {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-family: 'Inter', sans-serif;
        font-size: 1rem;
        transition: border-color 0.3s;
    }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

    .form-textarea {
        min-height: 120px;
        resize: vertical;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 15px;
        margin-top: 30px;
    }

    /* Responsive Design */
    @@media (max-width: 992px) {
        .sidebar

    {
        width: 200px;
    }

    .main-content {
        margin-left: 200px;
    }

    .filter-row {
        grid-template-columns: 1fr 1fr;
    }

    }

    @@media (max-width: 768px) {
        .nav-menu

    {
        display: none;
    }

    .mobile-toggle {
        display: block;
    }

    .sidebar {
        width: 70px;
        padding-top: 90px;
    }

        .sidebar a span {
            display: none;
        }

    .main-content {
        margin-left: 70px;
        padding: 90px 15px 30px;
    }

    .page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }

    .filter-row {
        grid-template-columns: 1fr;
    }

    .form-row {
        grid-template-columns: 1fr;
    }

    .modal {
        padding: 30px 20px;
    }

    .modal-footer {
        flex-direction: column;
    }

        .modal-footer .btn {
            width: 100%;
        }

    }

    @@media (max-width: 576px) {
        .sidebar

    {
        display: none;
    }

    .main-content {
        margin-left: 0;
    }

    }
</style>


<!-- Main Content -->
<div class="main-content">
    <div class="container">
        <!-- Jobs View -->

        <div class="page-header">
            <h2 class="page-title">Job Postings</h2>
            <button class="btn btn-primary" id="createJobBtn">
                <i class="fas fa-plus"></i> Create New Job
            </button>
        </div>

        <div class="table-responsive">
            <!-- Replaced original manual table with DataTable while keeping original classes/IDs -->
            <table id="jobTable" class="data-table">
                <thead>
                    <tr>
                        <th>S No</th>
                        <th>Job Title</th>
                        <th>Department</th>
                        <th>Location</th>
                        <th>Applications</th>
                        <th>Status</th>
                        <th>Expire Date</th>
                    </tr>
                </thead>
                <tbody id="job-table-body">
                    <!-- DataTable will populate rows here -->
                </tbody>
            </table>
        </div>


    </div>

</div>


<!-- Create Job Modal -->
<div class="modal-overlay" id="createJobModal">
    <div class="modal">
        <button class="modal-close">&times;</button>
        <h2 class="modal-title">Create New Job Posting</h2>
        <p class="modal-subtitle">Fill out the form below to create a new job posting</p>

        <form id="jobForm" asp-controller="Job" asp-action="PostJob">
            <!-- Hidden Fields (auto-generated by backend) -->
            <input type="hidden" id="jobId">
            <input id="postedBy" value="@UserId">
            <input type="hidden" id="isActive" value="1">

            <!-- Job Title + Department -->
            <div class="form-row">
                <div class="form-group">
                    <label for="jobTitle" class="form-label">Job Title</label>
                    <input type="text" id="jobTitle" class="form-input" placeholder="e.g. Senior .NET Core Developer" required>
                </div>

                <div class="form-group">
                    <label for="department" class="form-label">Department</label>
                    <select id="department" class="form-select" required>
                        <option value="">Select Department</option>
                        <option value="IT">IT</option>
                        <option value="HR">HR</option>
                        <option value="Finance">Finance</option>
                        <option value="Marketing">Marketing</option>
                        <option value="Sales">Sales</option>
                    </select>
                </div>
            </div>

            <!-- Location + Salary -->
            <div class="form-row">
                <div class="form-group">
                    <label for="location" class="form-label">Location</label>
                    <input type="text" id="location" class="form-input" placeholder="e.g. Chennai, India" required>
                </div>

                <div class="form-group">
                    <label for="salary" class="form-label">Salary (₹)</label>
                    <input type="number" id="salary" class="form-input" placeholder="e.g. 95000" required>
                </div>
            </div>

            <!-- Employment Type + Openings -->
            <div class="form-row">
                <div class="form-group">
                    <label for="employmentType" class="form-label">Employment Type</label>
                    <select id="employmentType" class="form-select" required>
                        <option value="">Select Type</option>
                        <option value="Full-time">Full-time</option>
                        <option value="Part-time">Part-time</option>
                        <option value="Contract">Contract</option>
                        <option value="Internship">Internship</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="openings" class="form-label">Number of Openings</label>
                    <input type="number" id="openings" class="form-input" placeholder="e.g. 2" required>
                </div>
            </div>

            <!-- Skills -->
            <div class="form-group">
                <label for="skills" class="form-label">Required Skills (comma separated)</label>
                <input type="text" id="skills" class="form-input" placeholder="e.g. .NET Core, SQL Server, Microservices" required>
            </div>

            <!-- Experience + Education (for AI only) -->
            <div class="form-row">
                <div class="form-group">
                    <label for="experience" class="form-label">Experience Level</label>
                    <select id="experience" class="form-select">
                        <option value="">Select Experience Level</option>
                        <option value="Intern">Intern</option>
                        <option value="Entry">Entry Level</option>
                        <option value="Mid">Mid Level</option>
                        <option value="Senior">Senior Level</option>
                        <option value="Director">Director</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="education" class="form-label">Education</label>
                    <select id="education" class="form-select">
                        <option value="">Select Education Level</option>
                        <option value="High School">High School</option>
                        <option value="Associate">Associate Degree</option>
                        <option value="Bachelor">Bachelor's Degree</option>
                        <option value="Master">Master's Degree</option>
                        <option value="PhD">PhD</option>
                    </select>
                </div>
            </div>

            <!-- Closing Date -->
            <div class="form-group">
                <label for="closingDate" class="form-label">Closing Date</label>
                <input type="datetime-local" id="closingDate" class="form-input" required>
            </div>

            <!-- Job Description with AI -->
            <div class="form-group">
                <label for="jobSummary" class="form-label">Job Summary</label>
                <button type="button" class="btn btn-secondary btn-sm" id="generateDescriptionBtn">
                    ✨ Generate with AI
                </button>
                <textarea id="jobSummary" class="form-input" style="min-height: 80px !important;" placeholder="Enter job Summary"></textarea>
            </div>

            <!-- Job Description with AI -->
            <div class="form-group">
                <label for="jobDescription" class="form-label">Job Description</label>
                <textarea id="jobDescription" class="form-input" style="min-height: 150px !important;" placeholder="Enter or generate job description"></textarea>
            </div>

            <!-- Footer Buttons -->
            <div class="modal-footer">
                <button type="button" class="btn" id="cancelBtn">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveDraftBtn">Save as Draft</button>
                <button type="submit" class="btn btn-success">Publish Job</button>
            </div>
        </form>
    </div>
</div>


<!-- DataTables and CKEditor includes -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.ckeditor.com/ckeditor5/36.0.1/classic/ckeditor.js"></script>
<script src="https://cdn.ckeditor.com/ckeditor5/36.0.1/html-support.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>

<script>
         $(function () {
        const $createJobModal = $('#createJobModal');
        const $jobForm = $('#jobForm');

        function openModal() {
            $createJobModal.addClass('active');
            $('body').css('overflow', 'hidden');
        }

        function closeModal() {
            $createJobModal.removeClass('active');
            $('body').css('overflow', 'auto');
        }

        // Button click events
        $('#createJobBtn').on('click', openModal);
        $('.modal-close, #cancelBtn').on('click', closeModal);

        // Close modal if background clicked
        $createJobModal.on('click', function (e) {
            if ($(e.target).is('#createJobModal')) {
                closeModal();
            }
        });
    });

            // Mobile menu toggle
            document.querySelector('.mobile-toggle')?.addEventListener('click', function() {
                const navMenu = document.querySelector('.nav-menu');
                if (navMenu) navMenu.style.display = navMenu.style.display === 'flex' ? 'none' : 'flex';
            });

            // Sample candidate data with detailed resume information
            const candidatesData = {
                1: [ // Frontend Developer
                    {
                        id: 1,
                        name: "John Smith",
                        position: "Frontend Developer",
                        status: "screening",
                        score: 87,
                        experience: "4 years",
                        education: "Bachelor's Degree in Computer Science",
                        applied: "Oct 12, 2023",
                        skills: ["React", "JavaScript", "HTML/CSS", "Redux", "TypeScript", "Vue.js", "SASS", "Webpack"],
                        image: "https://via.placeholder.com/100",
                        email: "john.smith@example.com",
                        phone: "(555) 123-4567",
                        location: "San Francisco, CA",
                        summary: "Experienced Frontend Developer with 4+ years of expertise in building responsive and user-friendly web applications. Strong proficiency in React, JavaScript, and modern CSS frameworks.",
                        workExperience: [
                            {
                                title: "Senior Frontend Developer",
                                company: "Tech Innovations Inc.",
                                duration: "Jan 2021 - Present",
                                description: "Led development of customer-facing React applications, improved performance by 40%, and mentored junior developers."
                            },
                            {
                                title: "Frontend Developer",
                                company: "Digital Solutions LLC",
                                duration: "Jun 2019 - Dec 2020",
                                description: "Developed and maintained multiple Vue.js applications, implemented responsive designs, and collaborated with UX team."
                            },
                            {
                                title: "Junior Web Developer",
                                company: "WebCraft Studios",
                                duration: "Aug 2018 - May 2019",
                                description: "Built websites using HTML, CSS, and JavaScript. Assisted in migrating legacy code to modern frameworks."
                            }
                        ],
                        education: [
                            {
                                degree: "Bachelor of Science in Computer Science",
                                institution: "University of California, Berkeley",
                                duration: "2014 - 2018",
                                description: "Graduated with honors. Relevant coursework: Algorithms, Data Structures, Web Development, UI/UX Design."
                            }
                        ],
                        certifications: [
                            "AWS Certified Developer - Associate",
                            "Google Mobile Web Specialist",
                            "React Advanced Certification"
                        ],
                        languages: [
                            "English (Native)",
                            "Spanish (Intermediate)"
                        ]
                    },
                    {
                        id: 2,
                        name: "Robert Wilson",
                        position: "Frontend Developer",
                        status: "rejected",
                        score: 42,
                        experience: "1 year",
                        education: "Associate Degree in Web Development",
                        applied: "Oct 13, 2023",
                        skills: ["HTML/CSS", "JavaScript", "jQuery", "Bootstrap"],
                        image: "https://via.placeholder.com/100",
                        email: "robert.wilson@example.com",
                        phone: "(555) 987-6543",
                        location: "Austin, TX",
                        summary: "Entry-level Frontend Developer with foundational knowledge of web technologies. Seeking opportunity to grow skills in modern frameworks.",
                        workExperience: [
                            {
                                title: "Web Developer Intern",
                                company: "Local Web Agency",
                                duration: "Mar 2022 - Feb 2023",
                                description: "Assisted in building client websites using HTML, CSS, and JavaScript. Performed website maintenance and updates."
                            }
                        ],
                        education: [
                            {
                                degree: "Associate Degree in Web Development",
                                institution: "Austin Community College",
                                duration: "2020 - 2022",
                                description: "Learned fundamentals of web development, design principles, and client-side scripting."
                            }
                        ],
                        certifications: [
                            "FreeCodeCamp Responsive Web Design Certification"
                        ],
                        languages: [
                            "English (Native)"
                        ]
                    },
                    {
                        id: 3,
                        name: "Emily Chen",
                        position: "Frontend Developer",
                        status: "interview",
                        score: 92,
                        experience: "5 years",
                        education: "Master's Degree in Human-Computer Interaction",
                        applied: "Oct 11, 2023",
                        skills: ["React", "TypeScript", "Vue", "SASS", "GraphQL", "Jest", "Next.js", "Webpack"],
                        image: "https://via.placeholder.com/100",
                        email: "emily.chen@example.com",
                        phone: "(555) 456-7890",
                        location: "New York, NY",
                        summary: "Senior Frontend Engineer with 5+ years of experience building scalable web applications. Passionate about creating intuitive user experiences and mentoring team members.",
                        workExperience: [
                            {
                                title: "Lead Frontend Engineer",
                                company: "FinTech Solutions",
                                duration: "Mar 2020 - Present",
                                description: "Lead a team of 5 developers in building financial dashboards using React and TypeScript. Implemented testing strategies that reduced bugs by 60%."
                            },
                            {
                                title: "Frontend Developer",
                                company: "E-Commerce Giant",
                                duration: "Jul 2018 - Feb 2020",
                                description: "Developed customer-facing features for high-traffic e-commerce platform. Optimized performance leading to 25% faster load times."
                            },
                            {
                                title: "UI Developer",
                                company: "Creative Agency",
                                duration: "Jun 2016 - Jun 2018",
                                description: "Created interactive websites and web applications for various clients using modern JavaScript frameworks."
                            }
                        ],
                        education: [
                            {
                                degree: "Master's in Human-Computer Interaction",
                                institution: "Carnegie Mellon University",
                                duration: "2014 - 2016",
                                description: "Focus on user-centered design, usability testing, and interface development."
                            },
                            {
                                degree: "Bachelor of Science in Computer Science",
                                institution: "University of Michigan",
                                duration: "2010 - 2014",
                                description: "Minor in Design. Graduated with honors."
                            }
                        ],
                        certifications: [
                            "Google UX Design Professional Certificate",
                            "AWS Certified Solutions Architect",
                            "Advanced React and Redux"
                        ],
                        languages: [
                            "English (Native)",
                            "Mandarin (Fluent)",
                            "French (Intermediate)"
                        ]
                    }
                ],
                2: [ // UX Designer
                    {
                        id: 4,
                        name: "Sarah Johnson",
                        position: "UX Designer",
                        status: "screening",
                        score: 92,
                        experience: "5 years",
                        education: "Master's Degree in Design",
                        applied: "Oct 11, 2023",
                        skills: ["Figma", "UI/UX", "Wireframing", "Prototyping", "User Research", "Illustrator", "Design Systems"],
                        image: "https://via.placeholder.com/100",
                        email: "sarah.johnson@example.com",
                        phone: "(555) 234-5678",
                        location: "Remote",
                        summary: "Senior UX Designer with 5 years of experience creating intuitive and beautiful digital products. Strong background in user research and interaction design.",
                        workExperience: [
                            {
                                title: "Senior UX Designer",
                                company: "Product Innovation Co.",
                                duration: "Jan 2021 - Present",
                                description: "Lead designer for SaaS products, conducted user research, created design systems, and collaborated with engineering teams."
                            },
                            {
                                title: "UX Designer",
                                company: "Digital Agency",
                                duration: "Jun 2018 - Dec 2020",
                                description: "Designed websites and applications for clients in various industries. Conducted usability testing and created interactive prototypes."
                            }
                        ],
                        education: [
                            {
                                degree: "Master's in Design",
                                institution: "Rhode Island School of Design",
                                duration: "2016 - 2018",
                                description: "Focus on interaction design and human-centered design methodologies."
                            }
                        ],
                        certifications: [
                            "NN/g UX Certification",
                            "Interaction Design Foundation Certificate"
                        ],
                        languages: [
                            "English (Native)",
                            "Spanish (Conversational)"
                        ]
                    }
                ]
            };

            // Job title data
            const jobTitles = {
                1: "Frontend Developer",
                2: "UX Designer",
                3: "Backend Developer",
                4: "Product Manager",
                5: "DevOps Engineer"
            };

            // View toggle functions
            const jobsView = document.getElementById('jobs-view') || document.querySelector('.main-content');
            const candidatesView = document.getElementById('candidates-view');
            const candidateGrid = document.getElementById('candidate-grid');
            const candidateTable = document.getElementById('candidate-table');
            const candidateTableBody = document.getElementById('candidate-table-body');
            const candidatesJobTitle = document.getElementById('candidates-job-title');
            const backToJobsBtn = document.getElementById('back-to-jobs');
            const gridViewBtn = document.getElementById('grid-view-btn');
            const tableViewBtn = document.getElementById('table-view-btn');

            // Modal elements
            const candidateProfileModal = document.getElementById('candidate-profile-modal');
            const candidateProfileContent = document.getElementById('candidate-profile-content');
            const modalClose = document.querySelector('.modal-close');

            // Current job ID for candidates view
            let currentJobId = null;

            // Initialize CKEditor for jobDescription
            let editorInstance;
    ClassicEditor
      .create(document.querySelector('#jobDescription'), {
        toolbar: [
          'heading', '|',
          'bold', 'italic', 'underline', '|',
          'bulletedList', 'numberedList', '|',
          'link', 'undo', 'redo'
        ],
        placeholder: 'Enter job description here...',
        htmlSupport: {
          allow: [
            {
              name: /.*/,            // allow all elements
              attributes: true,      // allow all attributes
              classes: true,         // allow all classes
              styles: true           // allow all inline styles
            }
          ]
        }
      })
      .then(editor => {
        editorInstance = editor;
      })
      .catch(console.error);


    $(document).ready(function () {

        // 🔹 Generate Job Description (AI)
        $("#generateDescriptionBtn").on("click", function () {
            const jobData = {
                jobTitle: $("#jobTitle").val(),
                department: $("#department").val(),
                location: $("#location").val(),
                skills: $("#skills").val(),
                experience: $("#experience").val(),
                JobSummary: $("#jobSummary").val(),
                JobDescription: $("#jobDescription").val(),
                education: $("#education").val(),
                salary: parseFloat($("#salary").val()) || null,
                employmentType: $("#employmentType").val(),
                openings: parseInt($("#openings").val()) || 0,
                closingDate: $("#closingDate").val(),
                postedBy: $("#postedBy").val() || null
            };

            if (!jobData.jobTitle || !jobData.department || !jobData.location) {
                alert("Please fill Job Title, Department and Location before generating description.");
                return;
            }

            $.ajax({
                url: "https://localhost:7180/api/Jobs/generate-jd",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify(jobData),
                success: function (data) {
                    // populate CKEditor and summary
                     if (editorInstance) {
                        editorInstance.setData(data.jobDescriptionHtml || "<p>No description generated.</p>");
                    }
                    $("#jobSummary").val(data.jobSummary || "");
                },
                error: function (xhr) {
                    console.error("Error generating description:", xhr.responseText);
                    alert("Something went wrong while generating description.");
                }
            });
        });

        //🔹 Save Draft
        $("#saveDraftBtn").on("click", function () {
            submitJobForm(true);
        });

        // 🔹 Publish Job
        $("#jobForm").on("submit", function (e) {
            e.preventDefault();
            submitJobForm(false);
        });

        // 🔹 Common Save Function
          function submitJobForm(isDraft) {
        const jobData = {
            JobTitle: $("#jobTitle").val(),
            JobSummary: $("#jobSummary").val(),
            JobDescription: editorInstance ? editorInstance.getData() : $("#jobDescription").val(),
            Department: $("#department").val(),
            Location: $("#location").val(),
            Skills: $("#skills").val(),
            Salary: parseFloat($("#salary").val()) || null,
            EmploymentType: $("#employmentType").val(),
            Openings: parseInt($("#openings").val()) || 1,
            ClosingDate: $("#closingDate").val() || null,
            Experience: $("#experience").val(),
            Education: $("#education").val(),
            PostedBy: $("#postedBy").val(), // should be Guid if set
            IsActive: !isDraft
        };

        console.log("Posting Job Data:", jobData);

        $.ajax({
            url: '@Url.Action("PostJob", "Job")',
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify(jobData),
            success: function (response) {
                if (response.success) {
                    alert(response.message);
                    $("#jobForm")[0].reset();
                    $("#createJobModal").removeClass('active');
                    // reload DataTable if exists
                    if ($.fn.dataTable.isDataTable('#jobTable')) {
                        $('#jobTable').DataTable().ajax.reload();
                    } else {
                        loadJobs(); // fallback
                    }
                } else {
                    alert("Error: " + response.message);
                }
            },
            error: function (xhr) {
                console.error("Error saving job:", xhr.responseText);
                alert("Error: " + (xhr.responseJSON?.message || "Unable to save job"));
            }
        });
    }

        // 🔹 Cancel button
        $("#cancelBtn").on("click", function () {
            $("#createJobModal").removeClass('active');
        });

        // --------------------
        // DataTable Initialization (replaces original loadJobs)
        // --------------------
        // Include a small loader CSS in page - DataTables will show processing element
        // Initialize DataTable for #jobTable and preserve original columns
        if ($.fn.dataTable) {
            const jobTable = $('#jobTable').DataTable({
                ajax: {
                    url: '@Url.Action("GetAllJobs", "Job")',
                    dataSrc: '',
                    beforeSend: function() {
                        // let DataTable show it's processing
                    }
                },
                columns: [
                    {
                        data: null,
                        render: function (data, type, row, meta) {
                            return meta.row + 1;
                        }
                    },
                    {
                        data: 'jobTitle',
                        render: function (data, type, row) {
                            return `<span class="job-title-cell" data-job-id="${row.jobId}">${data}</span>`;
                        }
                    },
                    { data: 'department' },
                    { data: 'location' },
                    { data: 'candidateCount', defaultContent: '0' },
                    {
                        data: null,
                        render: function (data, type, row) {
                            // Assuming jobStatus: 1=draft,0=active,2=closed (as in earlier partial)
                            const JobStatus = row.jobStatus == 1 ? "draft" : row.jobStatus == 0 ? "active" : "closed";
                            return `<span class="status-badge status-${JobStatus}">${JobStatus}</span>`;
                        }
                    },
                    {
                        data: 'closingDate',
                        render: function (data) {
                            if (!data) return '';
                            const d = new Date(data);
                            if (isNaN(d)) return data;
                            return d.toLocaleDateString();
                        }
                    }
                ],
                order: [[6, 'desc']], // sort by closing date default
                responsive: true,
                processing: true,
                serverSide: false,
                pageLength: 10,
                dom: 'Bfrtip',
                buttons: [
                    'copy', 'csv', 'excel', 'print'
                ],
                language: {
                    zeroRecords: "No jobs found — try adjusting your filters.",
                    loadingRecords: "Loading jobs...",
                    processing: "<div class='datatable-loader'><div class='spinner'></div><p>Fetching jobs...</p></div>"
                }
            });

            // When job title clicked, show candidates
            $(document).on('click', '.job-title-cell', function () {
                const jobId = $(this).data('job-id');
                // Keep existing behavior which navigated earlier to list of applications:
                window.location.href = "https://localhost:7149/JobApplications/ListAllApplications?JobId=" + jobId;
                // Or use showCandidates for client-side view:
                showCandidates(jobId);
            });

            // Filters example - reloading DataTable with params (optional)
            $('#filter-status, #filter-dept, #filter-location, #filter-sort').on('change', function () {
                // Build query params as needed by your API. Example below sends as DataTable ajax.url call.
                const status = $('#filter-status').val();
                const dept = $('#filter-dept').val();
                const location = $('#filter-location').val();
                const sort = $('#filter-sort').val();

                // Rebuild URL or pass params via ajax.data - here simple append query params
                let url = '@Url.Action("GetAllJobs", "Job")';
                const q = [];
                if (status) q.push('status=' + encodeURIComponent(status));
                if (dept) q.push('dept=' + encodeURIComponent(dept));
                if (location) q.push('location=' + encodeURIComponent(location));
                if (sort) q.push('sort=' + encodeURIComponent(sort));
                if (q.length) url += '?' + q.join('&');

                jobTable.ajax.url(url).load();
            });

            // Expose jobTable for other functions
            window._jobTable = jobTable;
        }

        // --------------------
        // Candidate rendering functions (unchanged except small safeguards)
        // --------------------

            // Function to show candidates for a specific job
            function showCandidates(jobId) {
                currentJobId = jobId;

                // If you want to navigate to server-side list, uncomment below:
                // window.location.href = "https://localhost:7149/JobApplications/ListAllApplications?JobId=" + currentJobId;

            }

       

            // Function to show candidate profile modal
            function showCandidateProfile(candidate) {
                // Generate profile content
                candidateProfileContent.innerHTML = `
                    <div class="candidate-profile-header">
                        <img src="${candidate.image}" alt="${candidate.name}" class="candidate-profile-image">
                        <div class="candidate-profile-info">
                            <h2 class="candidate-profile-name">${candidate.name}</h2>
                            <p class="candidate-profile-position">${candidate.position}</p>

                            <div class="candidate-profile-contact">
                                <div class="contact-item">
                                    <i class="fas fa-envelope"></i> ${candidate.email}
                                </div>
                                <div class="contact-item">
                                    <i class="fas fa-phone"></i> ${candidate.phone}
                                </div>
                                <div class="contact-item">
                                    <i class="fas fa-map-marker-alt"></i> ${candidate.location}
                                </div>
                            </div>

                            <div class="match-score ${candidate.score >= 80 ? 'score-high' : candidate.score >= 50 ? 'score-medium' : 'score-low'}" style="display: inline-flex;">
                                Match Score: ${candidate.score}%
                            </div>
                        </div>
                    </div>

                    <div class="profile-section">
                        <h3 class="profile-section-title">Professional Summary</h3>
                        <div class="profile-section-content">
                            <p>${candidate.summary}</p>
                        </div>
                    </div>

                    <div class="profile-section">
                        <h3 class="profile-section-title">Work Experience</h3>
                        <div class="profile-section-content">
                            ${candidate.workExperience.map(exp => `
                                <div class="experience-item">
                                    <div class="experience-title">${exp.title}</div>
                                    <div class="experience-company">${exp.company}</div>
                                    <div class="experience-date">${exp.duration}</div>
                                    <div class="experience-description">${exp.description}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="profile-section">
                        <h3 class="profile-section-title">Education</h3>
                        <div class="profile-section-content">
                            ${candidate.education.map(edu => `
                                <div class="education-item">
                                    <div class="education-title">${edu.degree}</div>
                                    <div class="education-institution">${edu.institution}</div>
                                    <div class="education-date">${edu.duration}</div>
                                    ${edu.description ? `<div class="education-description">${edu.description}</div>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="profile-section">
                        <h3 class="profile-section-title">Skills</h3>
                        <div class="profile-section-content">
                            <div class="skills-grid">
                                ${candidate.skills.map(skill => `
                                    <span class="skill-tag">${skill}</span>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    ${candidate.certifications && candidate.certifications.length > 0 ? `
                    <div class="profile-section">
                        <h3 class="profile-section-title">Certifications</h3>
                        <div class="profile-section-content">
                            <ul>
                                ${candidate.certifications.map(cert => `
                                    <li>${cert}</li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                    ` : ''}

                    ${candidate.languages && candidate.languages.length > 0 ? `
                    <div class="profile-section">
                        <h3 class="profile-section-title">Languages</h3>
                        <div class="profile-section-content">
                            <ul>
                                ${candidate.languages.map(lang => `
                                    <li>${lang}</li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                    ` : ''}
                `;

                // Show the modal
                candidateProfileModal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            // Function to close modal
            function closeModal() {
                candidateProfileModal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }

             $(document).on('click', '.job-title-cell' , function() {

         const jobId = $(this).data('job-id');
       // alert(jobId);
        showCandidates(jobId);
    });

            // Event listener for back to jobs button
            backToJobsBtn.addEventListener('click', function() {
                candidatesView.style.display = 'none';
                jobsView.style.display = 'block';
            });

            // Event listeners for view toggle buttons
            gridViewBtn.addEventListener('click', function() {
                candidateGrid.style.display = 'grid';
                candidateTable.style.display = 'none';
                gridViewBtn.classList.add('active');
                tableViewBtn.classList.remove('active');
            });

            tableViewBtn.addEventListener('click', function() {
                candidateGrid.style.display = 'none';
                candidateTable.style.display = 'block';
                tableViewBtn.classList.add('active');
                gridViewBtn.classList.remove('active');
            });

            // Event listener for modal close button
            modalClose.addEventListener('click', closeModal);

            // Close modal when clicking outside
            candidateProfileModal.addEventListener('click', function(e) {
                if (e.target === candidateProfileModal) {
                    closeModal();
                }
            });

        // Cancel fallback close handlers for createJobModal
        $(document).on('click', '.modal-close', function () {
            $('.modal-overlay').removeClass('active');
            $('body').css('overflow', 'auto');
        });

        // If any older code attempted to call loadJobs, DataTable handles it now
    });

     $(document).ready(function() {
        function loadJobs() {
             const tbody = $('#job-table-body');
            $.ajax({
                url: '@Url.Action("GetAllJobs", "Job")', // Replace with your API endpoint
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    tbody.empty(); // Clear existing rows
                      console.log("Jobs received:", data);

                      let Sno = 1;
                    data.forEach(job => {
                        var JobStatus = job.jobStatus == 1 ? "draft" : job.jobStatus == 0 ? "active" : "closed";

                        const row = `
                            <tr>
                                <td>${Sno}</td>
                                <td><span class="job-title-cell" data-job-id="${job.jobId}">${job.jobTitle}</span></td>
                                <td>${job.department}</td>
                                <td>${job.location}</td>
                                <td>${job.candidateCount}</td>
                                <td><span class="status-badge status-${JobStatus}">${JobStatus}</span></td>
                                <td>${job.closingDate}</td>
                            </tr>
                        `;
                        tbody.append(row);
                        Sno++;
                    });
                },
                error: function(err) {
                    console.error('Error loading jobs:', err);
                }
            });
        }

        // Initial load - if DataTable is present it already loaded; fallback only
        if (!$.fn.dataTable || !$('#jobTable').DataTable) {
            loadJobs();
        }
    });

</script>

@section Scripts {
    <script>
        const updatePreview = (selector, target) => {
            document.querySelector(selector).addEventListener('input', e => {
                document.getElementById(target).textContent = e.target.value || document.getElementById(target).dataset.default;
            });
        };
        // guard for preview elements (they may not exist in this view)
        if (document.getElementById('preview-title')) {
            document.getElementById('preview-title').dataset.default = '[Job Title]';
            document.getElementById('preview-dept').dataset.default = '[Department]';
            document.getElementById('preview-desc').dataset.default = '[Short description here]';

            updatePreview('[name="JobTitle"]', 'preview-title');
            updatePreview('[name="Department"]', 'preview-dept');
            updatePreview('[name="JobDescription"]', 'preview-desc');
        }
    </script>
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
